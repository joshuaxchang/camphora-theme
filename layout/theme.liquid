<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page_title }}</title>

    {{ content_for_header }}

    {{ 'application.min.css' | asset_url | stylesheet_tag }}
</head>
<body class="font-sans antialiased text-gray-800 bg-brand-bg">
    {% section 'header' %}

    <main>
        {{ content_for_layout }}
    </main>

    {% section 'footer' %}
    <div id="cart-drawer-backdrop" class="fixed inset-0 bg-black bg-opacity-50 z-30 invisible opacity-0 transition-opacity duration-300"></div>    
    {% render 'cart-drawer' %}
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const cartDrawer = document.getElementById('cart-drawer');
        const openCartButton = document.getElementById('open-cart-button');
        const closeCartButton = document.getElementById('close-cart-drawer');
        const backdrop = document.getElementById('cart-drawer-backdrop');

        function openDrawer() {
          backdrop.classList.remove('invisible');
          cartDrawer.classList.remove('translate-x-full');
          backdrop.classList.remove('opacity-0');
          backdrop.classList.add('opacity-100');
        }

        function closeDrawer() {
          cartDrawer.classList.add('translate-x-full');
          backdrop.classList.remove('opacity-100');
          backdrop.classList.add('opacity-0');
        }

        // Listen for the transition on the backdrop to finish
        backdrop.addEventListener('transitionend', function() {
          // If the opacity is 0 (meaning it just finished fading out)
          if (backdrop.classList.contains('opacity-0')) {
            backdrop.classList.add('invisible');
          }
        });

        if (openCartButton) {
          openCartButton.addEventListener('click', function(event) {
            event.stopPropagation();
            openDrawer();
          });
        }

        if (closeCartButton) {
          closeCartButton.addEventListener('click', closeDrawer);
        }
        
        document.addEventListener('click', function(event) {
          if (!cartDrawer.classList.contains('translate-x-full') && !cartDrawer.contains(event.target)) {
            closeDrawer();
          }
        });

        cartDrawer.addEventListener('click', function(event) {
          event.stopPropagation();
        });


        // --- Hamburger Menu Code ---
        const hamburgerButton = document.getElementById('hamburger-button');
        const mobileMenu = document.getElementById('mobile-menu');

        if (hamburgerButton && mobileMenu) {
          hamburgerButton.addEventListener('click', (e) => {
            e.stopPropagation();
            mobileMenu.classList.toggle('hidden');
          });

          document.addEventListener('click', (e) => {
            if (!mobileMenu.contains(e.target) && !hamburgerButton.contains(e.target)) {
              mobileMenu.classList.add('hidden');
            }
          });

          mobileMenu.addEventListener('click', (e) => {
            if (e.target.tagName === 'A') {
              mobileMenu.classList.add('hidden');
            }
          });
        }
      });
    </script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const headerSection = document.getElementById('shopify-section-header');
        if (headerSection) {
          headerSection.classList.add('bg-brand-bg/80', 'backdrop-blur-md', 'sticky', 'top-0', 'z-30');
        }
      });
    </script>
</body>
</html>